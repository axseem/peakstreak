(function(){const relList=document.createElement("link").relList;if(relList&&relList.supports&&relList.supports("modulepreload"))return;for(const link of document.querySelectorAll('link[rel="modulepreload"]'))processPreload(link);new MutationObserver(mutations=>{for(const mutation of mutations)if(mutation.type==="childList")for(const node of mutation.addedNodes)node.tagName==="LINK"&&node.rel==="modulepreload"&&processPreload(node)}).observe(document,{childList:!0,subtree:!0});function getFetchOpts(link){const fetchOpts={};return link.integrity&&(fetchOpts.integrity=link.integrity),link.referrerPolicy&&(fetchOpts.referrerPolicy=link.referrerPolicy),link.crossOrigin==="use-credentials"?fetchOpts.credentials="include":link.crossOrigin==="anonymous"?fetchOpts.credentials="omit":fetchOpts.credentials="same-origin",fetchOpts}function processPreload(link){if(link.ep)return;link.ep=!0;const fetchOpts=getFetchOpts(link);fetch(link.href,fetchOpts)}})();var SSR_NODE=1,TEXT_NODE=3,EMPTY_OBJ={},EMPTY_ARR=[],SVG_NS="http://www.w3.org/2000/svg",id=a=>a,map=EMPTY_ARR.map,isArray=Array.isArray,enqueue=typeof requestAnimationFrame<"u"?requestAnimationFrame:setTimeout,createClass=obj=>{var out="";if(typeof obj=="string")return obj;if(isArray(obj))for(var k=0,tmp;k<obj.length;k++)(tmp=createClass(obj[k]))&&(out+=(out&&" ")+tmp);else for(var k in obj)obj[k]&&(out+=(out&&" ")+k);return out},shouldRestart=(a,b)=>{for(var k in{...a,...b})if(typeof(isArray(a[k])?a[k][0]:a[k])=="function")b[k]=a[k];else if(a[k]!==b[k])return!0},patchSubs=(oldSubs,newSubs=EMPTY_ARR,dispatch)=>{for(var subs=[],i=0,oldSub,newSub;i<oldSubs.length||i<newSubs.length;i++)oldSub=oldSubs[i],newSub=newSubs[i],subs.push(newSub&&newSub!==!0?!oldSub||newSub[0]!==oldSub[0]||shouldRestart(newSub[1],oldSub[1])?[newSub[0],newSub[1],(oldSub&&oldSub[2](),newSub[0](dispatch,newSub[1]))]:oldSub:oldSub&&oldSub[2]());return subs},getKey=vdom=>vdom==null?vdom:vdom.key,patchProperty=(node,key,oldValue,newValue,listener,isSvg)=>{if(key==="style")for(var k in{...oldValue,...newValue})oldValue=newValue==null||newValue[k]==null?"":newValue[k],k[0]==="-"?node[key].setProperty(k,oldValue):node[key][k]=oldValue;else key[0]==="o"&&key[1]==="n"?((node.events||(node.events={}))[key=key.slice(2)]=newValue)?oldValue||node.addEventListener(key,listener):node.removeEventListener(key,listener):!isSvg&&key!=="list"&&key!=="form"&&key in node?node[key]=newValue??"":newValue==null||newValue===!1?node.removeAttribute(key):node.setAttribute(key,newValue)},createNode=(vdom,listener,isSvg)=>{var props=vdom.props,node=vdom.type===TEXT_NODE?document.createTextNode(vdom.tag):(isSvg=isSvg||vdom.tag==="svg")?document.createElementNS(SVG_NS,vdom.tag,props.is&&props):document.createElement(vdom.tag,props.is&&props);for(var k in props)patchProperty(node,k,null,props[k],listener,isSvg);for(var i=0;i<vdom.children.length;i++)node.appendChild(createNode(vdom.children[i]=maybeVNode(vdom.children[i]),listener,isSvg));return vdom.node=node},patch=(parent,node,oldVNode,newVNode,listener,isSvg)=>{if(oldVNode!==newVNode)if(oldVNode!=null&&oldVNode.type===TEXT_NODE&&newVNode.type===TEXT_NODE)oldVNode.tag!==newVNode.tag&&(node.nodeValue=newVNode.tag);else if(oldVNode==null||oldVNode.tag!==newVNode.tag)node=parent.insertBefore(createNode(newVNode=maybeVNode(newVNode),listener,isSvg),node),oldVNode!=null&&parent.removeChild(oldVNode.node);else{var tmpVKid,oldVKid,oldKey,newKey,oldProps=oldVNode.props,newProps=newVNode.props,oldVKids=oldVNode.children,newVKids=newVNode.children,oldHead=0,newHead=0,oldTail=oldVKids.length-1,newTail=newVKids.length-1;isSvg=isSvg||newVNode.tag==="svg";for(var i in{...oldProps,...newProps})(i==="value"||i==="selected"||i==="checked"?node[i]:oldProps[i])!==newProps[i]&&patchProperty(node,i,oldProps[i],newProps[i],listener,isSvg);for(;newHead<=newTail&&oldHead<=oldTail&&!((oldKey=getKey(oldVKids[oldHead]))==null||oldKey!==getKey(newVKids[newHead]));)patch(node,oldVKids[oldHead].node,oldVKids[oldHead],newVKids[newHead]=maybeVNode(newVKids[newHead++],oldVKids[oldHead++]),listener,isSvg);for(;newHead<=newTail&&oldHead<=oldTail&&!((oldKey=getKey(oldVKids[oldTail]))==null||oldKey!==getKey(newVKids[newTail]));)patch(node,oldVKids[oldTail].node,oldVKids[oldTail],newVKids[newTail]=maybeVNode(newVKids[newTail--],oldVKids[oldTail--]),listener,isSvg);if(oldHead>oldTail)for(;newHead<=newTail;)node.insertBefore(createNode(newVKids[newHead]=maybeVNode(newVKids[newHead++]),listener,isSvg),(oldVKid=oldVKids[oldHead])&&oldVKid.node);else if(newHead>newTail)for(;oldHead<=oldTail;)node.removeChild(oldVKids[oldHead++].node);else{for(var keyed={},newKeyed={},i=oldHead;i<=oldTail;i++)(oldKey=oldVKids[i].key)!=null&&(keyed[oldKey]=oldVKids[i]);for(;newHead<=newTail;){if(oldKey=getKey(oldVKid=oldVKids[oldHead]),newKey=getKey(newVKids[newHead]=maybeVNode(newVKids[newHead],oldVKid)),newKeyed[oldKey]||newKey!=null&&newKey===getKey(oldVKids[oldHead+1])){oldKey==null&&node.removeChild(oldVKid.node),oldHead++;continue}newKey==null||oldVNode.type===SSR_NODE?(oldKey==null&&(patch(node,oldVKid&&oldVKid.node,oldVKid,newVKids[newHead],listener,isSvg),newHead++),oldHead++):(oldKey===newKey?(patch(node,oldVKid.node,oldVKid,newVKids[newHead],listener,isSvg),newKeyed[newKey]=!0,oldHead++):(tmpVKid=keyed[newKey])!=null?(patch(node,node.insertBefore(tmpVKid.node,oldVKid&&oldVKid.node),tmpVKid,newVKids[newHead],listener,isSvg),newKeyed[newKey]=!0):patch(node,oldVKid&&oldVKid.node,null,newVKids[newHead],listener,isSvg),newHead++)}for(;oldHead<=oldTail;)getKey(oldVKid=oldVKids[oldHead++])==null&&node.removeChild(oldVKid.node);for(var i in keyed)newKeyed[i]==null&&node.removeChild(keyed[i].node)}}return newVNode.node=node},propsChanged=(a,b)=>{for(var k in a)if(a[k]!==b[k])return!0;for(var k in b)if(a[k]!==b[k])return!0},maybeVNode=(newVNode,oldVNode)=>newVNode!==!0&&newVNode!==!1&&newVNode?typeof newVNode.tag=="function"?((!oldVNode||oldVNode.memo==null||propsChanged(oldVNode.memo,newVNode.memo))&&((oldVNode=newVNode.tag(newVNode.memo)).memo=newVNode.memo),oldVNode):newVNode:text(""),recycleNode=node=>node.nodeType===TEXT_NODE?text(node.nodeValue,node):createVNode(node.nodeName.toLowerCase(),EMPTY_OBJ,map.call(node.childNodes,recycleNode),SSR_NODE,node),createVNode=(tag,{key,...props},children,type,node)=>({tag,props,key,children,type,node}),text=(value,node)=>createVNode(value,EMPTY_OBJ,EMPTY_ARR,TEXT_NODE,node),h=(tag,{class:c,...props},children=EMPTY_ARR)=>createVNode(tag,{...props,...c?{class:createClass(c)}:EMPTY_OBJ},isArray(children)?children:[children]),app=({node,view:view2,subscriptions,dispatch=id,init=EMPTY_OBJ})=>{var vdom=node&&recycleNode(node),subs=[],state,busy,update=newState=>{state!==newState&&((state=newState)==null&&(dispatch=subscriptions=render=id),subscriptions&&(subs=patchSubs(subs,subscriptions(state),dispatch)),view2&&!busy&&enqueue(render,busy=!0))},render=()=>node=patch(node.parentNode,node,vdom,vdom=view2(state),listener,busy=!1),listener=function(event){dispatch(this.events[event.type],event)};return(dispatch=dispatch((action,props)=>typeof action=="function"?dispatch(action(state,props)):isArray(action)?typeof action[0]=="function"?dispatch(action[0],action[1]):action.slice(1).map(fx=>fx&&fx!==!0&&(fx[0]||fx)(dispatch,fx[1]),update(action[0])):update(action)))(init),dispatch};const api={async post(path,body,token=null){const headers={"Content-Type":"application/json"};token&&(headers.Authorization=`Bearer ${token}`);const res=await fetch(path,{method:"POST",headers,body:JSON.stringify(body)}),data=await res.json();if(!res.ok)throw new Error(data.error||"An unknown error occurred");return data},async get(path,token){const headers={Authorization:`Bearer ${token}`},res=await fetch(path,{headers}),data=await res.json();if(!res.ok)throw new Error(data.error||"An unknown error occurred");return data}},savedUser=localStorage.getItem("peakstreak_user"),savedToken=localStorage.getItem("peakstreak_token"),initialState={view:savedUser&&savedToken?"dashboard":"login",user:savedUser?JSON.parse(savedUser):null,token:savedToken,habits:[],isLoading:!1,error:null,newHabitName:""},SetView=(state,view2)=>({...state,view:view2,error:null}),SetError=(state,error)=>(console.error("error: "+error),{...state,isLoading:!1,error}),SetLoading=(state,isLoading)=>({...state,isLoading}),HandleFormInput=(state,event)=>({...state,newHabitName:event.target.value}),SetAuth=(state,{user,token})=>(localStorage.setItem("peakstreak_user",JSON.stringify(user)),localStorage.setItem("peakstreak_token",token),{...state,user,token,view:"dashboard",isLoading:!1,error:null}),SetHabits=(state,habits)=>{const habitsWithStatus=habits.map(h2=>({...h2,loggedToday:!1}));return{...state,habits:habitsWithStatus,isLoading:!1}},MarkHabitAsLogged=(state,habitId)=>({...state,isLoading:!1,habits:state.habits.map(h2=>h2.id===habitId?{...h2,loggedToday:!0}:h2)}),Logout=_state=>(localStorage.removeItem("peakstreak_user"),localStorage.removeItem("peakstreak_token"),{...initialState,view:"login"}),FetchHabitsFx=(dispatch,{token,username})=>{dispatch(SetLoading,!0),api.get(`/api/users/${username}`,token).then(data=>dispatch(SetHabits,data.habits||[])).catch(err=>dispatch(SetError,err.message))},LoginFx=(dispatch,{identifier,password})=>{dispatch(SetLoading,!0),api.post("/api/auth/login",{identifier,password}).then(data=>{dispatch(SetAuth,data),FetchHabitsFx(dispatch,{token:data.token,username:data.user.username})}).catch(err=>dispatch(SetError,err.message))},SignUpFx=(dispatch,{username,email,password})=>{dispatch(SetLoading,!0),api.post("/api/auth/signup",{username,email,password}).then(()=>dispatch(SetView,"login")).catch(err=>dispatch(SetError,err.message))},CreateHabitFx=(dispatch,{name,token,username})=>{dispatch(SetLoading,!0),api.post("/api/habits",{name},token).then(()=>{FetchHabitsFx(dispatch,{token,username})}).catch(err=>dispatch(SetError,err.message))},LogHabitFx=(dispatch,{habitId,token})=>{const date=new Date().toISOString().split("T")[0];dispatch(SetLoading,!0),api.post(`/api/habits/${habitId}/logs`,{date,status:!0},token).then(()=>dispatch(MarkHabitAsLogged,habitId)).catch(err=>dispatch(SetError,err.message))},initFx=(dispatch,state)=>{state.user&&state.token&&FetchHabitsFx(dispatch,{token:state.token,username:state.user.username})},nativeInput=props=>h("input",{class:"bg-neutral-800 rounded p-2",...props}),Input=({label,id:id2,...rest})=>label===void 0?nativeInput({id:id2,...rest}):h("div",{class:"flex flex-col gap-2"},[h("label",{for:id2},text(label)),nativeInput({id:id2,name:id2,...rest})]),Button=({text:text$1,...rest})=>h("button",{class:"bg-white text-black hover:cursor-pointer rounded p-2",...rest},text(text$1)),AuthForm=props=>state=>{const buttonText=state.isLoading?"Loading...":props.isLogin?"Log In":"Create Account",linkText=props.isLogin?"Sign Up":"Log In";return h("div",{class:"w-full h-screen flex flex-col items-center justify-center gap-4"},[h("form",{class:"flex flex-col gap-4 w-80",onsubmit:(state2,event)=>{event.preventDefault();const formData=new FormData(event.target),data=Object.fromEntries(formData.entries());if(props.isLogin){const loginPayload={identifier:data.username,password:data.password};return[state2,[LoginFx,loginPayload]]}return[state2,[SignUpFx,data]]}},[Input({label:"Username",id:"username",type:"text",required:!0}),!props.isLogin&&Input({label:"Email",id:"email",type:"email",required:!0}),Input({label:"Password",id:"password",type:"password",required:!0}),state.error?h("p",{class:"text-red-400"},text(state.error)):null,Button({text:buttonText,type:"submit",disabled:state.isLoading})]),h("div",{class:"flex gap-2"},[h("span",{class:"text-neutral-400"},[text(props.isLogin?"Don't have an account? ":"Already have an account? ")]),h("a",{class:"underline cursor-pointer",onclick:[SetView,props.isLogin?"signup":"login"]},text(linkText))])])},DashboardView=state=>h("div",{class:"dashboard-container"},[h("header",{class:"header"},[h("h1",{},text(`Welcome, ${state.user?.username}`)),h("button",{class:"button-logout",onclick:Logout},text("Logout"))]),h("div",{class:"form-container"},[h("h2",{class:"w-80 bg-black text-white"},text("Create a New Habit")),h("form",{onsubmit:(state2,event)=>{event.preventDefault();const{newHabitName,token,user}=state2;return newHabitName.trim()&&token&&user?[{...state2,newHabitName:""},[CreateHabitFx,{name:newHabitName,token,username:user.username}]]:state2}},[h("input",{placeholder:"e.g., Read for 15 minutes",value:state.newHabitName,oninput:HandleFormInput,disabled:state.isLoading}),h("button",{type:"submit",disabled:state.isLoading||!state.newHabitName.trim()},text("Add Habit"))])]),h("div",{class:"habit-list-container"},[h("h2",{},text("Your Habits")),state.isLoading&&state.habits.length===0?h("p",{},text("Loading habits...")):h("div",{class:"habit-list"},state.habits.map(habit=>h("div",{class:"habit-item",key:habit.id},[h("span",{class:"habit-item-name"},text(habit.name)),h("button",{class:`habit-log-button ${habit.loggedToday?"logged":""}`,disabled:state.isLoading||habit.loggedToday,onclick:state2=>[state2,[LogHabitFx,{habitId:habit.id,token:state2.token}]]},text(habit.loggedToday?"Logged!":"Log for Today"))])))])]),view=state=>{switch(state.view){case"login":return AuthForm({isLogin:!0})(state);case"signup":return AuthForm({isLogin:!1})(state);case"dashboard":return DashboardView(state);default:return h("div",{},text("Page not found"))}};app({init:[initialState,[initFx,initialState]],view,node:document.getElementById("app")});
